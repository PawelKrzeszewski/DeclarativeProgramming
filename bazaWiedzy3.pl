%film(tytul,rok_produkcji,rezyser,lista_aktorow, lista_gatunkow)

film(zielona_mila, 1999, darabont, [hanks,morse,hunt,duncan,cromwell],[dramat, kryminal, fantastyka]).
film(skazani_na_shawshank, 1994, darabont, [robbins,freeman,gunton,sadler,brown],[dramat]).
film(forrest_gump, 1994, zemeckis, [hanks,wright,field,sinise,williamson],[dramat,komedia]).
film(leon_zawodowiec, 1994, besson, [reno,oldman,portman,aiello,appel],[akcja, kryminal, dramat]).
film(requiem_dla_snu, 2000, aronofsky, [burstyn,leto,connelly,wayans,mcdonald],[dramat]).
film(matrix, 1999, wachowski, [reeves,moss,fishburne,weaving,foster],[akcja, sci-fi]).
film(milczenie_owiec, 1991, demme,[hopkins,foster,levine,lemmons,bonney],[thriller,horror,kryminal]).
film(gladiator,2000,scott,[crowe,phoenix,nielsen,reed,jacobi],[dramat,akcja,przygodowy]).
film(avatar,2009,cameron,[worthington,saldana,weaver,lang,rodriguez],[sci-fi,akcja]).
film(shrek,2001,adamson,[myers,murphy,diaz,lithgrow,cassel],[animacja,familijny,komedia]).
film(szeregowiec_ryan,1998,spielberg,[hanks,sizemore,burns,pepper,goldberg],[dramat,wojenny,akcja]).
film(podziemny_krag,1999,fincher,[norton,pitt,bonham_carter,meat_loaf,leto],[sensacyjny,psychologiczny,kryminal]).
film(pulp_fiction,1994,tarantino,[travolta,jackson,thurman,willis,keitel],[gangsterski,kryminal,thriller]).
film(titanic,1997,cameron,[dicaprio,winslet,zane,bates,fisher],[melodramat,katastroficzny,romans]).
film(nietykalni,2011,nakache,[cluzet,sy,le_ny,fleurot,mollet],[biograficzny,dramat,komedia]).
film(chlopcy_z_ferajny,1990,scorsese,[de_niro,liotta,pesci,bracco,sorvino],[biograficzny,gangsterski,dramat]).
film(diuna,2021,villeneuve,[chalamet,ferguson,isaac,momoa,skarsgard],[przygodowy,sci-fi,akcja,dramat]).
film(diuna_czesc_druga,2024,villeneuve,[chalamet,zendaya,ferguson,bardem,brolin],[przygodowy,sci-fi,akcja,dramat]).
film(lot_nad_kukulczym_gniazdem,1975,forman,[nicholson,fletcher,lassick,dourif,devito],[dramat,psychologiczny]).
film(siedem,1995,fincher,[freeman,pitt,paltrow,spacey,zacapa],[kryminal,dramat,thriller]).
film(interstellar,2014,nolan,[mcconaughey,hathaway,chastain,caine,burstyn],[przygodowy,dramat,sci-fi]).
film(to_wspaniale_zycie,1946,capra,[stewart,reed,barrymore,mitchell,travers],[dramat,fantastyka,familijny,swiateczny]).
film(siedmiu_samurajow,1954,kurosawa,[shimura,mifune,inaba,miyaguchi],[akcja,dramat]).
film(miasto_boga,2002,meirelles,[rodrigues,firmino,haagensen,braga,sabino],[dramat,thriller,kryminal]).
film(zycie_jest_piekne,1997,benigni,[benigni,braschi,cantarini,durano,bini_bustric],[dramat,komedia,wojenny,romans]).
film('terminator_2:dzien_sadu',1991,cameron,[schwarzenegger,hamilton,furlong,patrick,boen],[akcja,przygodowy,sci-fi]).
film(ojciec_chrzestny,1972,coppola,[brando,pacino,duvall,caan,castellano],[dramat,gangsterski,kryminal]).
film(mroczny_rycerz,2008,nolan,[bale,ledger,eckhart,caine,gyllenhaal],[akcja,kryminal,dramat,sci-fi]).
film(ojciec_chrzestny_ii,1974,coppola,[pacino,duvall,keaton,de_niro,cazale],[dramat,gangsterski,kryminal]).
film(dwunastu_gniewnych_ludzi,1957,lumet,[balsam,fiedler,cobb,marshall,klugman],[dramat,kryminal]).
film(lista_schindlera,1993,spielberg,[neeson,kingsley,fiennes,goodall,sagall],[dramat,wojenny,historyczny,biograficzny]).
film('wladca_pierscieni:powrot_krola',2003,jackson,[wood,astin,monaghan,boyd,holm,mortensen],[fantastyka,przygodowy,dramat,akcja]).
film('wladca_pierscieni:druzyna_pierscienia',2001,jackson,[wood,astin,monaghan,boyd,holm,mortensen],[fantastyka,przygodowy,dramat,akcja]).
film('dobry,_zly_i_brzydki',1966,leone,[eastwood,van_cleef,wallach,brega,giuffre],[western,przygodowy]).
film('wladca_pierscieni:dwie_wierze',2002,jackson,[wood,astin,monaghan,boyd,mortensen],[fantastyka,przygodowy,dramat,akcja]).
film(incepcja,2010,nolan,[dicaprio,gordon-levitt,page,hardy,watanabe],[surrealistyczny,thriller,sci-fi,akcja,przygodowy]).
film(krol_lew,1994,allers,[broderick,kelly,earl_jones,irons,lane],[animacja,familijny,przygodowy]).
film(coco,2017,unkrich,[gonzalez,garcia_bernal,bratt,ubach,victor],[animacja,familijny,przygodowy]).
film(toy_story,1995,lasseter,[hanks,potts,varney,allen,rickles],[animacja,familijny,przygodowy,komedia]).
film(zakochany_bez_pamieci,2004,gondry,[carrey,winslet,dunst,ruffalo,wilkinson,wood],[dramat,sci-fi,romans]).

ocena(zielona_mila,86).
ocena(skazani_na_shawshank, 93).
ocena(forrest_gump,88).
ocena(leon_zawodowiec,85).
ocena(requiem_dla_snu,83).
ocena(matrix,87).
ocena(milczenie_owiec,86).
ocena(gladiator,85).
ocena(avatar,79).
ocena(shrek,79).
ocena(szeregowiec_ryan,86).
ocena(podziemny_krag,88).
ocena(pulp_fiction,89).
ocena(titanic,79).
ocena(nietykalni,85).
ocena(chlopcy_z_ferajny,87).
ocena(diuna,80).
ocena(diuna_czesc_druga,87).
ocena(lot_nad_kukulczym_gniazdem,87).
ocena(siedem,86).
ocena(interstellar,87).
ocena(to_wspaniale_zycie,86).
ocena(siedmiu_samurajow,86).
ocena(miasto_boga,86).
ocena(zycie_jest_piekne,86).
ocena('terminator_2:dzien_sadu',86).
ocena(ojciec_chrzestny,92).
ocena(mroczny_ryczerz,90).
ocena(ojciec_chrzestny_ii,90).
ocena(dwunastu_gniewnych_ludzi,90).
ocena(lista_schindlera,90).
ocena('wladca_pierscieni:powrot_krola',90).
ocena('wladca_pierscieni:druzyna_pierscienia',89).
ocena('dobry,_zly_i_brzydki',88).
ocena('wladca_pierscieni:dwie_wierze',88).
ocena(incepcja,88).
ocena(krol_lew,85).
ocena(coco,84).
ocena(toy_story,84).
ocena(zakochany_bez_pamieci,83).


% Predykat zwracaj�cy list� kategorii dla danego tytu�u filmu
kategorie_uzytkownika([],[]).
kategorie_uzytkownika([Film_Head|Film_Tail], Lista):-film(Film_Head,_,_,_,Kategorie),
                                                    kategorie_uzytkownika(Film_Tail,Lista1),
                                                    append(Lista1,Kategorie,Lista).

aktorzy_uzytkownika([],[]).
aktorzy_uzytkownika([Film_Head|Film_Tail], Lista):-film(Film_Head,_,_,Aktorzy,_),
                                                    aktorzy_uzytkownika(Film_Tail,Lista1),
                                                    append(Lista1,Aktorzy,Lista).


% Predykat count_occurrences(L, X, Count) liczy wyst<73>pienia elementu X w li<6C>cie L
count_occurrences([], _, 0).
count_occurrences([X|T], X, N) :-
    count_occurrences(T, X, N1),
    N is N1 + 1.
count_occurrences([Y|T], X, N) :-
    X \= Y,
    count_occurrences(T, X, N).


find_most_frequent(List, X) :-
    find_most_frequent(List, _, 0, X).

find_most_frequent([], CurrElem, _, CurrElem).
find_most_frequent([H|T], CurrElem, CurrCount, X) :-
    count_occurrences([H|T], H, Count),
    (Count > CurrCount ->
        find_most_frequent(T, H, Count, X)
    ;
        find_most_frequent(T, CurrElem, CurrCount, X)
    ).

% Predykat dominujace_kategorie(L, DominantCategory) znajduje dominuj<75>c<EFBFBD> kategori<72> w li<6C>cie L
dominujace([], none). % Dla pustej listy zwraca none

dominujace([LH|LT], DominantCategory) :-
    find_most_frequent(LT, LH, 1, DominantCategory).


znajdz_film(Kategoria,Obejrzane,Lista):-
                                        findall(Tytul-Ocena,(
                                        film(Tytul,_,_,_,Katy),
                                        member(Kategoria,Katy),
                                        \+ member(Tytul,Obejrzane),
                                        ocena(Tytul, Ocena)
                                        ),Lista1),
                                        sort(2, @>=, Lista1, Lista).

znajdz_po_aktorze(Aktor,Obejrzane,Lista):-
                                        findall(Tytul-Ocena,(
                                        film(Tytul,_,_,Aktorzy,_),
                                        member(Aktor,Aktorzy),
                                        \+ member(Tytul,Obejrzane),
                                        ocena(Tytul, Ocena)
                                        ),
                                                Lista1),
                                                sort(2, @>=, Lista1, Lista).

znajdz_film_i_po_aktorze(Kategoria,Aktor,Obejrzane,Lista):-
        findall(Tytul-Ocena, (
        film(Tytul, _, _, Aktorzy, KategorieFilmu),
        member(Kategoria, KategorieFilmu),
        member(Aktor, Aktorzy),
        \+ member(Tytul, Obejrzane),
        ocena(Tytul, Ocena)
    ), Lista1),sort(2, @>=, Lista1, Lista).


procedura(Obejrzane):-kategorie_uzytkownika(Obejrzane,Kategorie),
                      dominujace(Kategorie,Kategoria),
                      aktorzy_uzytkownika(Obejrzane,Aktorzy),
                      dominujace(Aktorzy,Aktor),!,Obejrzane1 = Obejrzane, Obejrzane2 = Obejrzane,
                      write(Aktor),nl,
                      znajdz_film_i_po_aktorze(Kategoria,Aktor,Obejrzane2,DoObejrzenia2),
                      write("Na podstawie ulubionego gatunku i ulubionego aktora: "),
                      write(DoObejrzenia2), nl,
                      znajdz_film(Kategoria,Obejrzane1,DoObejrzenia),
                      write("Na podstawie kategorii polecam: "),
                      write(DoObejrzenia),nl,!,
                      znajdz_po_aktorze(Aktor,Obejrzane,DoObejrzenia1),
                      write("Na podstawie ulubionych aktorow: "),
                      write(DoObejrzenia1).

czytaj_filmy(Akumulator, Lista) :-
                                  write("Podaj tytul filmu ktory ostatnio ogladales (wpisz 'koniec' aby zakonczyc): "),
                                  read(Film),
                                  (Film = 'koniec' ->
                                           Lista = Akumulator  % Je�li u�ytkownik wpisze 'koniec', przypisz list� akumulatora do listy wynikowej
                                                      ;
                                           append(Akumulator, [Film], NowyAkumulator),  % Dodaj film do akumulatora
                                           czytaj_filmy(NowyAkumulator, Lista)  % Rekurencyjnie kontynuuj zbieranie film�w
    ).
print_filmy([]).
print_filmy([Tytul-Ocena|Reszta]) :-
    format('~w (Ocena: ~w)~n', [Tytul, Ocena]),
    print_filmy(Reszta).

top3([],[]).
top3([X1],[X1]).
top3([X1,X2],[X1,X2]).
top3([X1,X2,X3|_],[X1,X2,X3]).

system_ekspertowy:-write("Witaj w systemie polecajacym filmy do obejrzenia.
Za chwile zostaniesz poproszony o podanie filmow ktore ostatnio ogladales."),
                    nl,
                    czytaj_filmy([],Obejrzane),
                      kategorie_uzytkownika(Obejrzane,Kategorie),
                      dominujace(Kategorie,Kategoria),
                      aktorzy_uzytkownika(Obejrzane,Aktorzy),
                      dominujace(Aktorzy,Aktor),!,Obejrzane1 = Obejrzane, Obejrzane2 = Obejrzane,
                      znajdz_film_i_po_aktorze(Kategoria,Aktor,Obejrzane2,DoObejrzenia2),
                      write("System za chwile przedstawi propozycje filmow. Wyswietlone zostana tytul filmu i po myslniku jego ocena od ogladajacych."),nl,
                      write("Najlepszymi filmami dla Ciebie beda (Wybrane na podstawie ulubionego gatunku i ulubionego aktora): "),nl,
                      top3(DoObejrzenia2,T3DoObejrzenia2),
                      print_filmy(T3DoObejrzenia2),!, nl,
                      znajdz_film(Kategoria,Obejrzane1,DoObejrzenia),
                      top3(DoObejrzenia,T3DoObejrzenia),
                      write("Na podstawie kategorii polecam: "),
                      print_filmy(T3DoObejrzenia),nl,
                      znajdz_po_aktorze(Aktor,Obejrzane,DoObejrzenia1),
                      top3(DoObejrzenia1,T3DoObejrzenia1),
                      write("Na podstawie ulubionych aktorow: "),
                      print_filmy(T3DoObejrzenia1),nl,
                      write("Dziekujemy za skorzystanie z naszego systemu polecajacego.").
